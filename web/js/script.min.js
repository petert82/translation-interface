/*! translation-interface 23-10-2014 */
angular.module("translation-interface",["ui.router","ti.common","ti.domain","ti.language","ti.string","ti.translation"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/domains"),a.state("domains",{url:"/domains",templateUrl:"/template/translation/index.html",controller:"DomainIndexController"}).state("domains.single",{url:"/:domainName/to/:languageCode",templateUrl:"/template/domain/list.html",controller:"SingleDomainController"})}]),angular.module("ti.common",["ti.common.services"]),angular.module("ti.common.services",[]),angular.module("ti.domain",["ti.domain.controllers","ti.domain.directives","ti.domain.filters","ti.domain.services"]),angular.module("ti.domain.controllers",[]),angular.module("ti.domain.directives",[]),angular.module("ti.domain.filters",[]),angular.module("ti.domain.services",[]),angular.module("ti.domain.controllers").controller("DomainIndexController",["$scope","$q","$state","DomainService","LanguageService",function(a,b,c,d,e){a.state="loading",a.domains=[],a.languages=[],a.selectedDomain="",a.selectedLanguage="";var f=[];f.push(d.query().then(function(b){a.domains=b})),f.push(e.query().then(function(b){a.languages=b})),b.all(f).then(function(){a.state="loaded"}),a.$watch("selectedDomain",function(b){g(b,a.selectedLanguage)}),a.$watch("selectedLanguage",function(b){g(a.selectedDomain,b)});var g=function(a,b){angular.isDefined(a)&&""!==a&&angular.isDefined(b)&&""!==b&&c.go("domains.single",{domainName:a,languageCode:b})};a.hasSelectedDomain=function(){return""!==a.selectedDomain},a.hasSelectedLanguage=function(){return""!==a.selectedLanguage}}]),angular.module("ti.domain.controllers").controller("SingleDomainController",["$scope","$stateParams","DomainService","TranslationService",function(a,b,c,d){a.state="loading",a.name=b.domainName,a.strings=[],a.language=b.languageCode,c.get(a.name).then(function(b){a.strings=b.strings}),a.saveTranslation=function(b,c){var e={domainName:a.name,stringName:b,languageCode:a.language,content:c};return d.save(e)}}]),angular.module("ti.domain.services").factory("DomainService",["$http","$q",function(a,b){var c="/api";return{query:function(){var d=b.defer();return a.get(c+"/domains").success(function(a){d.resolve(a.domains)}).error(function(){d.resolve([])}),d.promise},get:function(d){var e=b.defer();return a.get(c+"/domains/"+d).success(function(a){e.resolve(a)}).error(function(){e.resolve({})}),e.promise}}}]),angular.module("ti.language",["ti.language.services"]),angular.module("ti.language.services",[]),angular.module("ti.language.services").factory("LanguageService",["$http","$q",function(a,b){var c="/api";return{query:function(){var d=b.defer();return a.get(c+"/languages").success(function(a){d.resolve(a)}).error(function(){d.resolve([])}),d.promise}}}]),angular.module("ti.string",["ti.string.directives"]),angular.module("ti.string.directives",[]),angular.module("ti.string.directives").directive("stringControl",[function(){return{link:function(a){a.isNew=!0,a.workingTranslation=null,angular.isDefined(a.string.translations[a.workingLanguage])&&(a.isNew=!1,a.workingTranslation=a.string.translations[a.workingLanguage].content),a.lastSavedTranslation=a.workingTranslation,a.otherTranslations={},angular.forEach(a.string.translations,function(b,c){b!==a.workingLanguage&&(a.otherTranslations[c]=b.content)}),a.addNew=function(){a.workingTranslation=""},a.cancelChange=function(){a.workingTranslation=a.lastSavedTranslation},a.saveTranslation=function(){var b={stringName:a.string.name,content:a.workingTranslation,isNew:a.isNew};a.disable=!0,a.errorMessage=null,a.save(b).then(function(){a.lastSavedTranslation=a.workingTranslation,a.disable=!1},function(b){a.errorMessage=b,a.disable=!1})}},restrict:"E",scope:{string:"=",workingLanguage:"=",save:"&saveHandler"},templateUrl:"/template/string/control.html"}}]),angular.module("ti.translation",["ti.translation.services"]),angular.module("ti.translation.services",[]),angular.module("ti.translation.services").factory("TranslationService",["$http","$q",function(a,b){var c="/api";return{save:function(d){var e=b.defer();return a.post(c+"/domains/"+d.domainName+"/strings/"+d.stringName+"/translations/"+d.languageCode,{content:d.content}).success(function(a){e.resolve(angular.isDefined(a.result)&&"ok"===a.result?!0:!1)}).error(function(a){e.reject(a)}),e.promise}}}]);